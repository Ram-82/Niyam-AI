<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Niyam AI</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-layout {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background-color: var(--white);
            border-right: 1px solid #e2e8f0;
            padding: var(--space-3);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: var(--radius);
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.2s;
        }

        .sidebar-item:hover,
        .sidebar-item.active {
            background-color: #eff6ff;
            color: var(--primary-color);
        }

        .main-content {
            padding: var(--space-4);
            background-color: var(--bg-color);
        }

        .welcome-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }

        .metric-card {
            text-align: left;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: var(--space-4);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .settings-tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: 1px solid #e2e8f0;
        }

        .settings-tab-btn {
            padding: 10px 0;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.2s;
        }

        .settings-tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        th,
        td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        th {
            background-color: #f8fafc;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }

        /* Help Center Styles */
        .faq-item {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        /* Trend Chart Enhancements */
        .trend-chart-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h4 {
            margin: 0;
            font-size: 1.1rem;
            color: var(--text-dark);
        }

        .chart-controls {
            display: flex;
            gap: 8px;
        }

        .period-btn {
            background: #f1f5f9;
            border: none;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.2s;
        }

        .period-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .export-btn {
            background: white;
            border: 1px solid #e2e8f0;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .export-btn:hover {
            background: #f8fafc;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .chart-summary {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #f1f5f9;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .summary-item .label {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .summary-item .value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .trend {
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trend.up {
            color: var(--success);
        }

        .trend.down {
            color: var(--error);
        }

        .faq-question {
            padding: 15px;
            background: #f8fafc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
        }

        .faq-answer {
            padding: 15px;
            display: none;
            background: white;
            border-top: 1px solid #e2e8f0;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .faq-item.active .faq-question {
            background: #fff;
            color: var(--primary-color);
        }

        .video-card {
            background: #1e293b;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            aspect-ratio: 16 / 9;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
            text-align: center;
            padding: 20px;
        }

        .video-card:hover .video-overlay {
            background: rgba(0, 0, 0, 0.6);
        }

        .support-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        /* Subscription Module Styles */
        .subscription-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .current-plan-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            border-top: 5px solid var(--primary-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .plan-value-tag {
            background: #dcfce7;
            color: #166534;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 15px;
            display: inline-block;
        }

        .plan-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            background: #f1f5f9;
            padding: 5px;
            border-radius: 10px;
            width: fit-content;
        }

        .plan-tab-btn {
            padding: 10px 20px;
            border: none;
            background: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            transition: all 0.2s;
        }

        .plan-tab-btn.active {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .pricing-table-container {
            overflow-x: auto;
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .pricing-table {
            width: 100%;
            border-collapse: collapse;
        }

        .pricing-table th {
            padding: 20px;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }

        .pricing-table td {
            padding: 15px 20px;
            border-bottom: 1px solid #f1f5f9;
            text-align: center;
        }

        .pricing-table td:first-child {
            text-align: left;
            font-weight: 500;
            color: var(--text-dark);
        }

        .highlight-cell {
            background: rgba(37, 99, 235, 0.03);
            border-left: 2px solid var(--primary-color);
            border-right: 2px solid var(--primary-color);
        }

        .addons-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .addon-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .addon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .addon-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .addon-toggle {
            cursor: pointer;
            width: 40px;
            height: 20px;
            background: #cbd5e1;
            border-radius: 10px;
            position: relative;
            transition: background 0.2s;
        }

        .addon-toggle.active {
            background: var(--primary-color);
        }

        .addon-toggle::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.2s;
        }

        .addon-toggle.active::before {
            left: 22px;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-upcoming {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-overdue {
            background: #fee2e2;
            color: #991b1b;
        }

        .ask-niyam-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 350px;
            z-index: 1000;
        }

        .chat-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-color);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            margin-left: auto;
        }

        .chat-box {
            display: none;
            flex-direction: column;
            background: #fff;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
        }

        .chat-header {
            background: var(--primary-color);
            color: #fff;
            padding: 15px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
        }

        .chat-messages {
            height: 250px;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            max-width: 80%;
            padding: 10px;
            border-radius: 12px;
            font-size: 0.9rem;
        }

        .message-bot {
            background: #f1f5f9;
            align-self: flex-start;
        }

        .message-user {
            background: #eff6ff;
            color: var(--primary-color);
            align-self: flex-end;
        }

        .chat-input {
            padding: 10px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-content {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            max-width: 400px;
            text-align: center;
        }

        /* Calendar Styles */
        .calendar-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        #calendar {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            height: 700px;
        }

        .calendar-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .event-card {
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #cbd5e1;
            background: #fff;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .event-card:hover {
            transform: translateX(5px);
        }

        .event-gst {
            border-color: #2563eb;
        }

        .event-tds {
            border-color: #10b981;
        }

        .event-roc {
            border-color: #ef4444;
        }

        .event-custom {
            border-color: #f59e0b;
        }

        @media (max-width: 1024px) {
            .calendar-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            .ask-niyam-widget {
                width: calc(100% - 40px);
                right: 20px;
                bottom: 20px;
            }
        }
    </style>
</head>

<body>

    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div style="margin-bottom: var(--space-6); padding: 0 10px;">
                <img src="logo.svg" alt="Niyam AI" height="35">
            </div>

            <div class="sidebar-group">
                <div class="sidebar-group-label">Compliance</div>
                <a href="#" class="sidebar-item active" onclick="switchView('dashboard', this)"><i
                        data-feather="home"></i> Dashboard</a>
                <a href="#" class="sidebar-item" onclick="switchView('calendar', this)"><i data-feather="calendar"></i>
                    Calendar View</a>
                <a href="#" class="sidebar-item" onclick="switchView('gst', this)"><i data-feather="file-text"></i> GST
                    Filings</a>
                <a href="#" class="sidebar-item" onclick="switchView('tds', this)"><i data-feather="dollar-sign"></i>
                    TDS & Taxes</a>
                <a href="#" class="sidebar-item" onclick="switchView('roc', this)"><i data-feather="briefcase"></i> ROC
                    & Legal</a>
                <a href="#" class="sidebar-item" onclick="switchView('reports', this)"><i
                        data-feather="bar-chart-2"></i> Reports & Analytics</a>
            </div>

            <div class="sidebar-group">
                <div class="sidebar-group-label">Actions</div>
                <a href="#" class="sidebar-item" onclick="switchView('upload', this)"><i data-feather="upload"></i>
                    Upload Invoices</a>
                <a href="#" class="sidebar-item" onclick="switchView('bank', this)"><i data-feather="link"></i> Connect
                    Bank</a>
                <a href="#" class="sidebar-item" onclick="switchView('ca-portal', this)"><i data-feather="users"></i> CA
                    Portal Access</a>
            </div>

            <div class="sidebar-group" style="margin-top: auto;">
                <div class="sidebar-group-label">Account</div>
                <a href="#" class="sidebar-item" onclick="switchView('settings', this)"><i data-feather="settings"></i>
                    Settings</a>
                <a href="#" class="sidebar-item" onclick="switchView('support', this)"><i
                        data-feather="help-circle"></i> Help & Support</a>
                <a href="index.html" class="sidebar-item" style="color: var(--error);"><i data-feather="log-out"></i>
                    Logout</a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div id="toast-container"></div>

            <!-- View: Dashboard -->
            <section id="view-dashboard" class="content-view active">
                <div class="welcome-bar">
                    <div>
                        <h1 id="welcome-text">Good morning, Business User</h1>
                        <p style="color: var(--text-light);">Here's what's happening with your compliance today.</p>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button class="btn btn-primary" style="padding: 8px 16px;"><i data-feather="plus"
                                style="width: 16px;"></i> New Filing</button>
                        <div
                            style="width: 40px; height: 40px; border-radius: 50%; background: #e2e8f0; display: flex; align-items: center; justify-content: center;">
                            <i data-feather="user"></i>
                        </div>
                    </div>
                </div>

                <!-- Metrics Grid -->
                <div class="metrics-grid">
                    <div class="card metric-card status-border-error" style="cursor: pointer;"
                        onclick="filterTable('Upcoming')">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Upcoming Deadlines</p>
                        <div class="metric-value">
                            <span>3</span>
                            <div class="status-dot" style="background: var(--error); animation: pulse 2s infinite;">
                            </div>
                        </div>
                        <p style="font-size: 0.8rem; color: var(--error);">Next due in 4 days</p>
                    </div>
                    <div class="card metric-card status-border-success" style="cursor: pointer;"
                        onclick="showHealthBreakdown()">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Compliance Health</p>
                        <div class="metric-value">
                            <span>85%</span>
                        </div>
                        <div
                            style="width: 100%; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden;">
                            <div style="width: 85%; height: 100%; background: var(--success);"></div>
                        </div>
                    </div>
                    <div class="card metric-card status-border-success" id="risk-card">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Penalty Risk</p>
                        <div class="metric-value">
                            <span style="color: var(--success);">Low Risk</span>
                        </div>
                        <p style="font-size: 0.8rem; color: var(--text-light);">No immediate threats detected</p>
                    </div>
                </div>

                <!-- Deadlines Table -->
                <div class="card" style="padding: 0;">
                    <div
                        style="padding: 20px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="font-size: 1.1rem;">Compliance Deadlines</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-outline" style="padding: 4px 12px; font-size: 0.8rem; border-width: 1px;"
                                onclick="filterTable('all')">All</button>
                            <button class="btn-outline" style="padding: 4px 12px; font-size: 0.8rem; border-width: 1px;"
                                onclick="filterTable('Overdue')">Overdue</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="deadlines-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr data-status="Upcoming">
                                    <td style="font-weight: 600;">GST-3B</td>
                                    <td>June 20, 2025</td>
                                    <td><span class="badge badge-upcoming">Upcoming</span></td>
                                    <td><button class="btn-action">File Now</button></td>
                                </tr>
                                <tr data-status="Upcoming">
                                    <td style="font-weight: 600;">TDS Quarterly</td>
                                    <td>July 10, 2025</td>
                                    <td><span class="badge badge-upcoming">Upcoming</span></td>
                                    <td><button class="btn-action">File Now</button></td>
                                </tr>
                                <tr data-status="Overdue" class="status-border-error">
                                    <td style="font-weight: 600;">ROC Filing</td>
                                    <td>May 30, 2025</td>
                                    <td><span class="badge badge-overdue">Overdue</span></td>
                                    <td><button class="btn-action"
                                            style="color: var(--error); border-color: var(--error);">File Now</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Quick Links -->
                <div style="margin-top: var(--space-4);">
                    <h3 style="margin-bottom: var(--space-2);">Quick Links</h3>
                    <div style="display: flex; gap: var(--space-2); flex-wrap: wrap;">
                        <a href="#" class="btn btn-outline"
                            style="border-color: #e2e8f0; color: var(--text-dark); border-width: 1px;"
                            onclick="showToast('Downloading Compliance Report...')"><i data-feather="download"
                                style="width: 16px; margin-right: 8px;"></i> Download Compliance Report</a>
                        <a href="#" class="btn btn-outline"
                            style="border-color: #e2e8f0; color: var(--text-dark); border-width: 1px;"
                            onclick="showToast('Connecting to your CA...')"><i data-feather="user"
                                style="width: 16px; margin-right: 8px;"></i> Contact Your CA</a>
                        <a href="#" class="btn btn-outline"
                            style="border-color: #e2e8f0; color: var(--text-dark); border-width: 1px;"
                            onclick="showToast('Fetching GST Credit data...')"><i data-feather="credit-card"
                                style="width: 16px; margin-right: 8px;"></i> View GST Credit</a>
                    </div>
                </div>
            </section>

            <!-- View: GST filing -->
            <section id="view-gst" class="content-view">
                <div class="welcome-bar">
                    <h1>GST Compliance Hub</h1>
                    <button class="btn btn-primary" onclick="showToast('Opening GSTR portal...')">Direct Portal
                        Login</button>
                </div>
                <div class="metrics-grid">
                    <div class="card metric-card">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Total Tax Liability</p>
                        <div class="metric-value">₹42,500</div>
                        <p style="font-size: 0.8rem; color: var(--text-light);">Current month's estimate</p>
                    </div>
                    <div class="card metric-card">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Available ITC (2B)</p>
                        <div class="metric-value">₹1,12,000</div>
                        <p style="font-size: 0.8rem; color: var(--success);">Matched with Purchase Register</p>
                    </div>
                    <div class="card metric-card">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Next Filing (GSTR-1)</p>
                        <div class="metric-value">11th July</div>
                        <p style="font-size: 0.8rem; color: var(--primary-color);">8 days remaining</p>
                    </div>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 20px;">GST Reconciliation (2B vs Books)</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Supplier Name</th>
                                    <th>GSTIN</th>
                                    <th>ITC in 2B</th>
                                    <th>ITC in Books</th>
                                    <th>Difference</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Reliance Retail Ltd</td>
                                    <td>27AAAAA0000A1Z5</td>
                                    <td>₹12,400</td>
                                    <td>₹12,400</td>
                                    <td>₹0</td>
                                    <td><span class="badge"
                                            style="background: var(--success); color: white;">Matched</span></td>
                                </tr>
                                <tr class="status-border-warning">
                                    <td>Aman Enterprises</td>
                                    <td>07BBBBB1111B2Z6</td>
                                    <td>₹0</td>
                                    <td>₹8,200</td>
                                    <td style="color: var(--error);">-₹8,200</td>
                                    <td><span class="badge" style="background: var(--warning); color: white;">Missing in
                                            2B</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- View: Upload -->
            <section id="view-upload" class="content-view">
                <div class="welcome-bar">
                    <h1>AI Data Upload & OCR</h1>
                </div>
                <div class="card"
                    style="padding: 40px; text-align: center; border: 2px dashed #cbd5e1; background: #f8fafc;">
                    <i data-feather="upload-cloud"
                        style="width: 48px; height: 48px; color: var(--primary-color); margin-bottom: 20px;"></i>
                    <h3>Drag and drop invoices or bank statements</h3>
                    <p style="color: var(--text-light); margin: 10px 0 20px;">Niyam AI will automatically extract data
                        using OCR.</p>
                    <input type="file" id="file-upload-input" style="display: none;" onchange="handleFileUpload(this)">
                    <button class="btn btn-primary"
                        onclick="document.getElementById('file-upload-input').click()">Browse Files</button>

                    <div id="upload-progress" style="display: none; margin-top: 30px; text-align: left;">
                        <p style="font-size: 0.9rem; font-weight: 600; margin-bottom: 5px;">Analyzing
                            "Purchase_Invoice_June.pdf"... <span id="progress-percent">0%</span></p>
                        <div
                            style="width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                            <div id="progress-bar-inner"
                                style="width: 0%; height: 100%; background: var(--primary-color); transition: width 0.3s;">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="ocr-results" style="display: none; margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">Extracted Data Preview</h3>
                    <div class="card">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <p style="font-size: 0.8rem; color: var(--text-light);">Vendor</p>
                                <p style="font-weight: 600;">Office Supplies Inc.</p>
                            </div>
                            <div>
                                <p style="font-size: 0.8rem; color: var(--text-light);">GSTIN Extracted</p>
                                <p style="font-weight: 600;">29CCCDD0000C1Z1</p>
                            </div>
                            <div>
                                <p style="font-size: 0.8rem; color: var(--text-light);">Date</p>
                                <p style="font-weight: 600;">June 15, 2025</p>
                            </div>
                            <div>
                                <p style="font-size: 0.8rem; color: var(--text-light);">Total Amount</p>
                                <p style="font-weight: 600;">₹4,250.00</p>
                            </div>
                        </div>
                        <div style="margin-top: 20px; text-align: right;">
                            <button class="btn btn-outline" style="padding: 8px 16px; font-size: 0.8rem;"
                                onclick="showToast('Redoing OCR...')">Retry OCR</button>
                            <button class="btn btn-primary" style="padding: 8px 16px; font-size: 0.8rem;"
                                onclick="showToast('Data synced to GST Purchase Register!')">Confirm & Sync</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- View: Calendar -->
            <section id="view-calendar" class="content-view">
                <div class="welcome-bar">
                    <h1>Interactive Compliance Calendar</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-outline" onclick="showToast('Syncing with Google Calendar...')">
                            <i data-feather="refresh-cw" style="width: 16px; margin-right: 8px;"></i> Sync Google
                            Calendar
                        </button>
                        <button class="btn btn-primary" onclick="openAddDeadlineModal()">
                            <i data-feather="plus" style="width: 16px; margin-right: 8px;"></i> Add Deadline
                        </button>
                    </div>
                </div>

                <div class="calendar-layout">
                    <div id="calendar"></div>
                    <div class="calendar-sidebar">
                        <div class="card">
                            <h3 style="margin-bottom: 15px;">Upcoming This Week</h3>
                            <div id="upcoming-events-list">
                                <div class="event-card event-gst"
                                    onclick="showEventDetails('GSTR-1 Filing', '2025-06-11')">
                                    <p style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 5px;">June
                                        11, 2025</p>
                                    <p style="font-weight: 600;">GSTR-1 Monthly filing</p>
                                </div>
                                <div class="event-card event-roc" style="margin-top: 10px;"
                                    onclick="showEventDetails('ROC Annual Return', '2025-06-15')">
                                    <p style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 5px;">June
                                        15, 2025</p>
                                    <p style="font-weight: 600;">ROC Annual Return</p>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <h3 style="margin-bottom: 10px;">Legend</h3>
                            <div style="display: flex; flex-direction: column; gap: 8px; font-size: 0.85rem;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span
                                        style="width: 12px; height: 12px; border-radius: 3px; background: #2563eb;"></span>
                                    GST Deadlines
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span
                                        style="width: 12px; height: 12px; border-radius: 3px; background: #10b981;"></span>
                                    TDS & Taxes
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span
                                        style="width: 12px; height: 12px; border-radius: 3px; background: #ef4444;"></span>
                                    ROC & Legal
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span
                                        style="width: 12px; height: 12px; border-radius: 3px; background: #f59e0b;"></span>
                                    Custom
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Other Views (Placeholders) -->
            <!-- View: TDS -->
            <section id="view-tds" class="content-view">
                <div class="welcome-bar">
                    <h1>TDS & Tax Management</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-outline" onclick="showToast('Downloading Form 16A Template...')">
                            <i data-feather="download" style="width: 16px; margin-right: 8px;"></i> Download Certificate
                        </button>
                    </div>
                </div>

                <!-- Quarterly Summary -->
                <div class="metrics-grid">
                    <div class="card metric-card">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Q1 Liability</p>
                        <div class="metric-value">₹85,400</div>
                        <p style="font-size: 0.8rem; color: var(--success);">Paid & Verified</p>
                    </div>
                    <div class="card metric-card">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Q2 Liability</p>
                        <div class="metric-value">₹92,100</div>
                        <p style="font-size: 0.8rem; color: var(--success);">Paid & Verified</p>
                    </div>
                    <div class="card metric-card">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Q3 Current Liability</p>
                        <div class="metric-value">₹45,200</div>
                        <p style="font-size: 0.8rem; color: var(--warning);">Payment Pending</p>
                    </div>
                    <div class="card metric-card">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Avg. Interest (Late)</p>
                        <div class="metric-value">₹0</div>
                        <p style="font-size: 0.8rem; color: var(--text-light);">No late payments this year</p>
                    </div>
                </div>

                <div class="grid" style="display: grid; grid-template-columns: 1fr 350px; gap: 20px;">
                    <!-- Challan Tracker -->
                    <div class="card" style="padding: 0;">
                        <div
                            style="padding: 20px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="font-size: 1.1rem;">Challan Status Tracker</h3>
                            <button class="btn-outline" style="padding: 4px 12px; font-size: 0.8rem;"
                                onclick="showToast('Syncing with TRACES...')">Sync TRACES</button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Challan No.</th>
                                        <th>Section</th>
                                        <th>Amount</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>CH-88291</td>
                                        <td>194C</td>
                                        <td>₹12,500</td>
                                        <td>Dec 05, 2025</td>
                                        <td><span class="badge"
                                                style="background: var(--success); color: white;">Verified</span></td>
                                    </tr>
                                    <tr>
                                        <td>CH-88295</td>
                                        <td>194J</td>
                                        <td>₹32,700</td>
                                        <td>Nov 07, 2025</td>
                                        <td><span class="badge"
                                                style="background: var(--success); color: white;">Verified</span></td>
                                    </tr>
                                    <tr class="status-border-warning">
                                        <td>-</td>
                                        <td>194I</td>
                                        <td>₹45,200</td>
                                        <td>Due Jan 07</td>
                                        <td><span class="badge"
                                                style="background: var(--warning); color: white;">Pending</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Interest Calculator -->
                    <div class="card">
                        <h3 style="margin-bottom: 15px;">Interest Calculator</h3>
                        <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 15px;">Calculate 1.5%
                            interest per month for late TDS payments.</p>
                        <div class="form-group">
                            <label>Principal Amount (₹)</label>
                            <input type="number" id="calc-amount" placeholder="e.g. 50000">
                        </div>
                        <div class="form-group">
                            <label>Months Delayed</label>
                            <input type="number" id="calc-months" placeholder="e.g. 2">
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 10px;"
                            onclick="calculateTDSInterest()">Calculate Now</button>
                        <div id="calc-result"
                            style="display: none; margin-top: 15px; padding: 10px; background: #f8fafc; border-radius: 8px; text-align: center;">
                            <p style="font-size: 0.8rem; color: var(--text-light);">Estimated Interest</p>
                            <h3 id="calc-interest-value" style="color: var(--error);">₹0</h3>
                        </div>
                    </div>
                </div>

                <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <!-- 26AS Simulation -->
                    <div class="card">
                        <h3 style="margin-bottom: 15px;">Form 26AS Verification</h3>
                        <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 20px;">Upload your 26AS
                            CSV to reconcile with your books.</p>
                        <div
                            style="border: 2px dashed #e2e8f0; padding: 30px; border-radius: 12px; text-align: center;">
                            <i data-feather="file-text"
                                style="width: 32px; height: 32px; color: var(--text-light); margin-bottom: 10px;"></i>
                            <br>
                            <button class="btn btn-outline" style="font-size: 0.85rem;"
                                onclick="showToast('Selecting 26AS file...')">Choose CSV File</button>
                        </div>
                    </div>

                    <!-- Due Date Alerts -->
                    <div class="card status-border-error">
                        <h3 style="margin-bottom: 15px;">TDS Deadline Alerts</h3>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div
                                style="display: flex; align-items: start; gap: 12px; padding: 10px; background: #fff5f5; border-radius: 8px;">
                                <i data-feather="alert-circle" style="color: var(--error); width: 20px;"></i>
                                <div>
                                    <p style="font-weight: 600; font-size: 0.9rem;">Payment Due: Jan 07, 2026</p>
                                    <p style="font-size: 0.75rem; color: var(--text-light);">Section 194I (Rent) payment
                                        of ₹45,200 is due in 4 days.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- View: ROC -->
            <section id="view-roc" class="content-view">
                <div class="welcome-bar">
                    <h1>ROC & Legal Compliance</h1>
                    <button class="btn btn-primary" onclick="showToast('Connecting to MCA V3 Portal...')">Sync MCA
                        Data</button>
                </div>

                <div class="metrics-grid">
                    <div class="card metric-card status-border-success">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            KYC Status</p>
                        <div class="metric-value">Verified</div>
                        <p style="font-size: 0.8rem; color: var(--success);">DIR-3 KYC Completed</p>
                    </div>
                    <div class="card metric-card status-border-error">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Annual Filing</p>
                        <div class="metric-value">Due Soon</div>
                        <p style="font-size: 0.8rem; color: var(--error);">AOC-4 & MGT-7 Pending</p>
                    </div>
                    <div class="card metric-card status-border-success">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Disqualification Risk</p>
                        <div class="metric-value">Near Zero</div>
                        <p style="font-size: 0.8rem; color: var(--success);">Active DIN Status</p>
                    </div>
                </div>

                <div class="grid" style="display: grid; grid-template-columns: 1fr 350px; gap: 20px;">
                    <!-- MCA Checklist -->
                    <div class="card">
                        <h3 style="margin-bottom: 20px;">MCA Compliance Checklist</h3>
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8fafc; border-radius: 8px;">
                                <div>
                                    <p style="font-weight: 600;">Form AOC-4 (Financials)</p>
                                    <p style="font-size: 0.75rem; color: var(--text-light);">Due within 30 days of AGM
                                    </p>
                                </div>
                                <span class="badge" style="background: var(--warning); color: white;">Pending</span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8fafc; border-radius: 8px;">
                                <div>
                                    <p style="font-weight: 600;">Form MGT-7 (Annual Return)</p>
                                    <p style="font-size: 0.75rem; color: var(--text-light);">Due within 60 days of AGM
                                    </p>
                                </div>
                                <span class="badge" style="background: var(--warning); color: white;">Pending</span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f0fdf4; border-radius: 8px;">
                                <div>
                                    <p style="font-weight: 600;">DIR-3 KYC</p>
                                    <p style="font-size: 0.75rem; color: var(--text-light);">Annual Director KYC</p>
                                </div>
                                <span class="badge" style="background: var(--success); color: white;">Completed</span>
                            </div>
                        </div>
                    </div>

                    <!-- Actions & Support -->
                    <div class="card" style="display: flex; flex-direction: column; gap: 20px;">
                        <h3 style="margin-bottom: 5px;">Legal Actions</h3>
                        <button class="btn btn-primary" style="width: 100%;"
                            onclick="showToast('Scheduling expert consultation...')">
                            <i data-feather="users" style="width: 16px; margin-right: 8px;"></i> Book CA Consultation
                        </button>
                        <div
                            style="padding: 15px; background: #eff6ff; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                            <p
                                style="font-size: 0.85rem; font-weight: 600; color: var(--primary-color); margin-bottom: 5px;">
                                Legal Vault</p>
                            <p style="font-size: 0.75rem; color: var(--text-light);">Directly store and retrieve COI,
                                PAN, AOA, and MOA.</p>
                            <button class="btn-outline" style="margin-top: 10px; font-size: 0.75rem;"
                                onclick="showToast('Opening Document Repository...')">Open Repository</button>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px; padding: 0;">
                    <div style="padding: 20px; border-bottom: 1px solid #f1f5f9;">
                        <h3>Legal Notice Tracker</h3>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Notice Type</th>
                                    <th>Issuing Authority</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Oct 12, 2025</td>
                                    <td>Clarification on GSTR-2A</td>
                                    <td>GST Department</td>
                                    <td><span class="badge"
                                            style="background: var(--success); color: white;">Closed</span></td>
                                    <td><button class="btn-outline" style="font-size: 0.75rem;"
                                            onclick="showToast('Viewing Response...')">View History</button></td>
                                </tr>
                                <tr class="status-border-warning">
                                    <td>Jan 02, 2026</td>
                                    <td>Director Address Update</td>
                                    <td>MCA / ROC</td>
                                    <td><span class="badge" style="background: var(--warning); color: white;">Pending
                                            Action</span></td>
                                    <td><button class="btn-primary" style="font-size: 0.75rem;"
                                            onclick="showToast('Uploading Address Proof...')">Respond Now</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            <!-- View: Reports -->
            <section id="view-reports" class="content-view">
                <div class="welcome-bar">
                    <h1>Reports & Analytics</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-outline" onclick="showToast('Generating Compliance Health PDF...')"><i
                                data-feather="file-text" style="width: 16px; margin-right: 5px;"></i> Health Report
                            (PDF)</button>
                        <button class="btn btn-primary" onclick="showToast('Exporting Analytics to Excel...')"><i
                                data-feather="download" style="width: 16px; margin-right: 5px;"></i> Export
                            Data</button>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="card metric-card status-border-success">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Optimization Score</p>
                        <div class="metric-value">92%</div>
                        <p style="font-size: 0.8rem; color: var(--success);">↑ 4% from last month</p>
                    </div>
                    <div class="card metric-card status-border-warning">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Est. Tax Savings</p>
                        <div class="metric-value">₹12,400</div>
                        <p style="font-size: 0.8rem; color: var(--warning);">Potential ITC uncapped</p>
                    </div>
                    <div class="card metric-card status-border-error">
                        <p
                            style="color: var(--text-light); text-transform: uppercase; font-size: 0.7rem; font-weight: 600;">
                            Penalty Risk</p>
                        <div class="metric-value">₹0</div>
                        <p style="font-size: 0.8rem; color: var(--success);">All filings on track</p>
                    </div>
                </div>

                <div class="grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                    <!-- Charts -->
                    <div class="trend-chart-card">
                        <div class="chart-header">
                            <h4>Tax Liability & Cash Flow Trend</h4>
                            <div class="chart-controls">
                                <button class="period-btn active" onclick="updateChartPeriod('6M', this)">6M</button>
                                <button class="period-btn" onclick="updateChartPeriod('1Y', this)">1Y</button>
                                <button class="period-btn" onclick="updateChartPeriod('QTD', this)">QTD</button>
                                <button class="export-btn" onclick="exportChart('liabilityChart')"><i
                                        data-feather="download" style="width: 14px;"></i> Export</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="liabilityChart"></canvas>
                        </div>
                        <div class="chart-summary">
                            <div class="summary-item">
                                <span class="label">Current Tax Liability:</span>
                                <span class="value">₹62,000</span>
                                <span class="trend up">↑ 8% from last month</span>
                            </div>
                        </div>
                        <div id="no-js-fallback"
                            style="display: none; margin-top: 15px; font-size: 0.8rem; color: var(--error);">
                            Enable JavaScript for interactive chart
                        </div>
                        <div style="margin-top: 15px; text-align: center;">
                            <a href="#" style="font-size: 0.8rem; color: var(--primary-color);"
                                onclick="toggleDataTable()">Show Data Table</a>
                        </div>
                        <div id="data-table-container" style="display: none; margin-top: 15px;">
                            <table style="width: 100%; font-size: 0.75rem; border-collapse: collapse;">
                                <thead style="background: #f8fafc;">
                                    <tr>
                                        <th style="padding: 8px; border: 1px solid #e2e8f0;">Month</th>
                                        <th style="padding: 8px; border: 1px solid #e2e8f0;">Liability</th>
                                        <th style="padding: 8px; border: 1px solid #e2e8f0;">Cash Flow</th>
                                        <th style="padding: 8px; border: 1px solid #e2e8f0;">ITC</th>
                                    </tr>
                                </thead>
                                <tbody id="chart-data-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Optimization Suggestions -->
                    <div class="card">
                        <h3 style="margin-bottom: 15px;">Smart Suggestions</h3>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div
                                style="padding: 12px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--success);">
                                <p style="font-size: 0.85rem; font-weight: 600; color: #166534;">ITC Optimization</p>
                                <p style="font-size: 0.75rem; color: #15803d;">Reclaim ₹8,200 by verifying 12 pending
                                    vendor invoices.</p>
                            </div>
                            <div
                                style="padding: 12px; background: #eff6ff; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                                <p style="font-size: 0.85rem; font-weight: 600; color: var(--primary-color);">Quarterly
                                    Strategy</p>
                                <p style="font-size: 0.75rem; color: var(--text-light);">Switching to QRMP scheme could
                                    save 2 hours/month on GST.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <!-- Penalty Avoidance Calculator -->
                    <div class="card">
                        <h3 style="margin-bottom: 15px;">Penalty Avoidance Calculator</h3>
                        <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 15px;">Estimate late fees
                            for delayed filings.</p>
                        <div class="form-group">
                            <label>Days Late</label>
                            <input type="number" id="penalty-days" placeholder="e.g. 10">
                        </div>
                        <div class="form-group">
                            <label>Filing Type</label>
                            <select id="penalty-type"
                                style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                                <option value="50">GST (GSTR-3B) - ₹50/day</option>
                                <option value="200">ROC Annual Return - ₹200/day</option>
                                <option value="100">TDS Payment - Interest Based</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 10px;"
                            onclick="calculatePenalty()">Estimate Penalty</button>
                        <div id="penalty-result"
                            style="display: none; margin-top: 15px; padding: 10px; background: #fff5f5; border-radius: 8px; text-align: center;">
                            <p style="font-size: 0.8rem; color: var(--text-light);">Estimated Late Fee</p>
                            <h3 id="penalty-value" style="color: var(--error);">₹0</h3>
                        </div>
                    </div>

                    <!-- Compliance Impact on Cash Flow -->
                    <div class="card">
                        <div class="chart-header">
                            <h3>Compliance Impact on Cash Flow</h3>
                            <div class="chart-controls">
                                <button class="period-btn active"
                                    onclick="updateComplianceChartPeriod('6M', this)">6M</button>
                                <button class="period-btn" onclick="updateComplianceChartPeriod('1Y', this)">1Y</button>
                                <button class="period-btn"
                                    onclick="updateComplianceChartPeriod('YTD', this)">YTD</button>
                                <button class="export-btn" onclick="exportChart('cashflowChart')">
                                    <i data-feather="download" style="width: 14px;"></i> Export
                                </button>
                            </div>
                        </div>
                        <div class="chart-container" style="height: 400px;">
                            <canvas id="cashflowChart"></canvas>
                        </div>
                        <div class="chart-summary"
                            style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #f1f5f9;">
                            <div
                                style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; font-size: 0.85rem;">
                                <div>
                                    <p style="color: var(--text-light); margin-bottom: 4px;">Avg Compliance Cost</p>
                                    <p style="font-weight: 700; font-size: 1.1rem; color: var(--text-dark);"
                                        id="avg-compliance-pct">9.2%</p>
                                </div>
                                <div>
                                    <p style="color: var(--text-light); margin-bottom: 4px;">Highest Impact</p>
                                    <p style="font-weight: 700; font-size: 1.1rem; color: var(--text-dark);"
                                        id="highest-impact-month">March</p>
                                </div>
                                <div>
                                    <p style="color: var(--text-light); margin-bottom: 4px;">Current Impact Score</p>
                                    <p style="font-weight: 700; font-size: 1.1rem; color: var(--success);"
                                        id="current-impact-score">88/100</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- View: CA Portal -->
            <section id="view-ca-portal" class="content-view">
                <div class="welcome-bar">
                    <h1>CA Portal Access</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary"
                            onclick="showToast('Initiating return filing workflow...')">Approve & File Now</button>
                    </div>
                </div>

                <div class="grid" style="display: grid; grid-template-columns: 350px 1fr; gap: 20px;">
                    <!-- CA Messaging & Tasks -->
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div class="card" style="padding: 0;">
                            <div
                                style="padding: 15px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="font-size: 1rem;">Secure Thread</h3>
                                <span class="badge"
                                    style="background: var(--primary-color); color: white;">Online</span>
                            </div>
                            <div id="ca-chat-messages"
                                style="height: 300px; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: #f8fafc;">
                                <div
                                    style="align-self: flex-start; background: white; padding: 10px; border-radius: 8px; font-size: 0.8rem; box-shadow: var(--shadow-sm); max-width: 80%;">
                                    <p style="font-weight: 600; color: var(--primary-color);">CA Rajesh</p>
                                    <p>I've reviewed your GSTR-2B reconciliation. Please check the 'Version 2' of the
                                        Purchase Register.</p>
                                </div>
                                <div
                                    style="align-self: flex-end; background: var(--primary-color); color: white; padding: 10px; border-radius: 8px; font-size: 0.8rem; box-shadow: var(--shadow-sm); max-width: 80%;">
                                    <p>Sure, checking now. Do I need to re-upload any invoices?</p>
                                </div>
                            </div>
                            <div style="padding: 10px; border-top: 1px solid #f1f5f9; display: flex; gap: 5px;">
                                <input type="text" placeholder="Type a message..."
                                    style="flex-grow: 1; border: 1px solid #e2e8f0; border-radius: 4px; padding: 5px 10px; font-size: 0.8rem;">
                                <button class="btn btn-primary" style="padding: 5px 10px;"
                                    onclick="showToast('Message sent to CA.')"><i data-feather="send"
                                        style="width: 14px;"></i></button>
                            </div>
                        </div>

                        <div class="card">
                            <h3 style="margin-bottom: 15px; font-size: 1rem;">Pending Tasks</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px; font-size: 0.85rem;">
                                    <input type="checkbox" checked>
                                    <span style="text-decoration: line-through; color: var(--text-light);">Upload May
                                        Bank Statement</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px; font-size: 0.85rem;">
                                    <input type="checkbox">
                                    <span>Approve TDS Draft (Jan 2026)</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px; font-size: 0.85rem;">
                                    <input type="checkbox">
                                    <span>Sign GST Authorization Letter</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Client Management & Document Versioning -->
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div class="card">
                            <h3>Document Sharing & Versioning</h3>
                            <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 20px;">Securely
                                manage and version your compliance documents.</p>

                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Document Name</th>
                                            <th>Version</th>
                                            <th>Date Uploaded</th>
                                            <th>Uploaded By</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><i data-feather="file" style="width: 14px; margin-right: 5px;"></i>
                                                GSTR-1_Summary.pdf</td>
                                            <td><span class="badge"
                                                    style="background: #e2e8f0; color: var(--text-dark);">v2.0</span>
                                            </td>
                                            <td>Jan 02, 2026</td>
                                            <td>CA Rajesh</td>
                                            <td><button class="btn-outline" style="font-size: 0.7rem;"
                                                    onclick="showToast('Downloading version 2.0...')">Download</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><i data-feather="file" style="width: 14px; margin-right: 5px;"></i>
                                                GSTR-1_Summary.pdf</td>
                                            <td><span class="badge"
                                                    style="background: #f1f5f9; color: var(--text-light);">v1.0</span>
                                            </td>
                                            <td>Dec 28, 2025</td>
                                            <td>You</td>
                                            <td><button class="btn-outline" style="font-size: 0.7rem;"
                                                    onclick="showToast('Downloading version 1.0...')">Download</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><i data-feather="file" style="width: 14px; margin-right: 5px;"></i>
                                                TDS_Jan_Draft.xlsx</td>
                                            <td><span class="badge"
                                                    style="background: #e2e8f0; color: var(--text-dark);">v1.0</span>
                                            </td>
                                            <td>Jan 03, 2026</td>
                                            <td>You</td>
                                            <td><button class="btn-primary" style="font-size: 0.7rem;"
                                                    onclick="showToast('Finalizing draft...')">Approve</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <button class="btn btn-outline" style="width: 100%; border-style: dashed;"
                                onclick="showToast('Opening upload dialog...')">+ Upload New Document</button>
                        </div>

                        <div class="card" style="background: #eff6ff; border: 1px solid #bfdbfe;">
                            <h3>Auditor Filing Overview</h3>
                            <div class="metrics-grid" style="margin-top: 15px; margin-bottom: 0;">
                                <div style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                    <p style="font-size: 0.7rem; color: var(--text-light);">PREPARED</p>
                                    <p style="font-size: 1.2rem; font-weight: 700;">4/5</p>
                                </div>
                                <div style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                    <p style="font-size: 0.7rem; color: var(--text-light);">APPROVED</p>
                                    <p style="font-size: 1.2rem; font-weight: 700;">2/5</p>
                                </div>
                                <div style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                    <p style="font-size: 0.7rem; color: var(--text-light);">FILED</p>
                                    <p style="font-size: 1.2rem; font-weight: 700; color: var(--success);">1/5</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- View: Settings -->
            <section id="view-settings" class="content-view">
                <div class="welcome-bar">
                    <h1>Settings</h1>
                    <button class="btn btn-primary" onclick="showToast('Settings saved successfully!')">Save All
                        Changes</button>
                </div>

                <div class="settings-tabs">
                    <button class="settings-tab-btn active" onclick="switchSettingsTab('profile', this)">Business
                        Profile</button>
                    <button class="settings-tab-btn"
                        onclick="switchSettingsTab('integrations', this)">Integrations</button>
                    <button class="settings-tab-btn"
                        onclick="switchSettingsTab('notifications', this)">Notifications</button>
                    <button class="settings-tab-btn" onclick="switchSettingsTab('team', this)">Team Access</button>
                    <button class="settings-tab-btn" onclick="switchSettingsTab('billing', this)">Billing</button>
                    <button class="settings-tab-btn" onclick="switchSettingsTab('privacy', this)">Data &
                        Privacy</button>
                </div>

                <!-- Profile Section -->
                <div id="settings-profile" class="settings-section active">
                    <div class="card">
                        <h3 style="margin-bottom: 20px;">Business Details</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>Legal Business Name</label>
                                <input type="text" id="setting-biz-name" value="Niyam Enterprises Pvt Ltd">
                            </div>
                            <div class="form-group">
                                <label>GSTIN</label>
                                <input type="text" value="27AAAAA0000A1Z5">
                            </div>
                            <div class="form-group">
                                <label>PAN</label>
                                <input type="text" value="ABCDE1234F">
                            </div>
                            <div class="form-group">
                                <label>Contact Email</label>
                                <input type="email" value="admin@niyam.ai">
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Registered Address</label>
                                <textarea
                                    style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">123, Business Park, Phase II, Mumbai, Maharashtra - 400001</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Integrations Section -->
                <div id="settings-integrations" class="settings-section">
                    <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="card">
                            <h3 style="margin-bottom: 15px;">Banking Relationships</h3>
                            <div
                                style="padding: 15px; border: 1px solid #e2e8f0; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div
                                        style="width: 40px; height: 40px; background: #eff6ff; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--primary-color);">
                                        <i data-feather="database"></i>
                                    </div>
                                    <div>
                                        <p style="font-weight: 600;">HDFC Bank</p>
                                        <p style="font-size: 0.75rem; color: var(--success);">Connected & Syncing</p>
                                    </div>
                                </div>
                                <button class="btn-outline" style="font-size: 0.7rem;"
                                    onclick="showToast('Re-authenticating...')">Manage</button>
                            </div>
                            <button class="btn btn-outline" style="width: 100%; border-style: dashed;"
                                onclick="switchView('bank')">+ Connect New Bank</button>
                        </div>
                        <div class="card">
                            <h3 style="margin-bottom: 15px;">Government Portals</h3>
                            <div style="display: flex; flex-direction: column; gap: 15px;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <img src="https://www.gst.gov.in/img/logo.png" height="24" alt="GST">
                                        <span style="font-weight: 500;">GST Portal</span>
                                    </div>
                                    <span class="badge" style="background: var(--success); color: white;">Linked</span>
                                </div>
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <img src="https://www.mca.gov.in/content/dam/mca/logo/mca_logo.png" height="24"
                                            alt="MCA">
                                        <span style="font-weight: 500;">MCA V3 Portal</span>
                                    </div>
                                    <span class="badge" style="background: var(--warning); color: white;">Action
                                        Required</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notifications Section -->
                <div id="settings-notifications" class="settings-section">
                    <div class="card">
                        <h3 style="margin-bottom: 20px;">Alert Preferences</h3>
                        <div style="display: flex; flex-direction: column; gap: 20px;">
                            <div
                                style="display: flex; align-items: center; justify-content: space-between; padding-bottom: 15px; border-bottom: 1px solid #f1f5f9;">
                                <div>
                                    <p style="font-weight: 600;">Compliance Deadlines</p>
                                    <p style="font-size: 0.85rem; color: var(--text-light);">Get notified 7 days, 3
                                        days, and 24 hours before any filing deadline.</p>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <label
                                        style="display: flex; align-items: center; gap: 5px; font-size: 0.8rem;"><input
                                            type="checkbox" checked> Email</label>
                                    <label
                                        style="display: flex; align-items: center; gap: 5px; font-size: 0.8rem;"><input
                                            type="checkbox" checked> SMS</label>
                                    <label
                                        style="display: flex; align-items: center; gap: 5px; font-size: 0.8rem;"><input
                                            type="checkbox" checked> WhatsApp</label>
                                </div>
                            </div>
                            <div
                                style="display: flex; align-items: center; justify-content: space-between; padding-bottom: 15px; border-bottom: 1px solid #f1f5f9;">
                                <div>
                                    <p style="font-weight: 600;">Weekly Analytics Report</p>
                                    <p style="font-size: 0.85rem; color: var(--text-light);">Receive a summary of your
                                        compliance health and tax liability every Monday.</p>
                                </div>
                                <input type="checkbox" checked>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <p style="font-weight: 600;">Anomalous Transaction Alerts</p>
                                    <p style="font-size: 0.85rem; color: var(--text-light);">Instant alerts if AI
                                        detects potential missing ITC or duplicate invoices.</p>
                                </div>
                                <input type="checkbox" checked>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Section -->
                <div id="settings-team" class="settings-section">
                    <div class="card" style="padding: 0;">
                        <div
                            style="padding: 20px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="font-size: 1.1rem;">Team Members</h3>
                            <button class="btn btn-primary" style="padding: 6px 14px; font-size: 0.8rem;"
                                onclick="showToast('Inviting new member...')">+ Add Member</button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="font-weight: 600;">Rahul Sharma (You)</td>
                                        <td>rahul@niyam.ai</td>
                                        <td><span class="badge" style="background: #e2e8f0;">Owner</span></td>
                                        <td><span class="badge"
                                                style="background: var(--success); color: white;">Active</span></td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">CA Rajesh Kumar</td>
                                        <td>rajesh@taxpros.in</td>
                                        <td><span class="badge"
                                                style="background: #eff6ff; color: var(--primary-color);">Auditor</span>
                                        </td>
                                        <td><span class="badge"
                                                style="background: var(--success); color: white;">Active</span></td>
                                        <td><button class="btn-outline" style="font-size: 0.7rem;"
                                                onclick="showToast('Revoking access...')">Revoke</button></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Priya Singh</td>
                                        <td>priya@niyam.ai</td>
                                        <td><span class="badge" style="background: #f1f5f9;">Viewer</span></td>
                                        <td><span class="badge"
                                                style="background: #cbd5e1; color: white;">Pending</span></td>
                                        <td><button class="btn-outline" style="font-size: 0.7rem;"
                                                onclick="showToast('Resending invitation...')">Resend</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Billing Section -->
                <div id="settings-billing" class="settings-section">
                    <div class="subscription-section">
                        <!-- SECTION 1: Current Plan Display -->
                        <div class="current-plan-card">
                            <div style="flex: 1;">
                                <p
                                    style="font-size: 0.8rem; color: var(--text-light); text-transform: uppercase; font-weight: 600; letter-spacing: 0.05em;">
                                    Your Current Plan</p>
                                <h1 style="font-size: 2rem; margin: 10px 0; color: var(--primary-color);">Compliance Pro
                                    (Annual)</h1>
                                <p style="font-size: 1.1rem; font-weight: 500;">₹2,999/month <span
                                        style="font-size: 0.9rem; color: var(--text-light); font-weight: normal;">(billed
                                        annually at ₹28,790)</span></p>

                                <div
                                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                                    <div style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem;">
                                        <i data-feather="check-circle" style="width: 16px; color: var(--success);"></i>
                                        Unlimited Invoices
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem;">
                                        <i data-feather="check-circle" style="width: 16px; color: var(--success);"></i>
                                        AI ITC Matching
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem;">
                                        <i data-feather="check-circle" style="width: 16px; color: var(--success);"></i>
                                        CA Collaboration
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem;">
                                        <i data-feather="check-circle" style="width: 16px; color: var(--success);"></i>
                                        Priority Support
                                    </div>
                                </div>

                                <div class="plan-value-tag">
                                    <i data-feather="trending-up" style="width: 14px; margin-right: 5px;"></i>
                                    Value saved this year: ₹47,500 (penalties avoided)
                                </div>
                            </div>

                            <div
                                style="text-align: right; border-left: 1px solid #e2e8f0; padding-left: 30px; margin-left: 30px;">
                                <p style="font-size: 0.85rem; color: var(--text-light);">Next Renewal</p>
                                <p style="font-size: 1.1rem; font-weight: 600; margin-bottom: 25px;">October 15, 2026
                                </p>

                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <button class="btn btn-primary"
                                        onclick="showToast('Loading plan upgrades...')">Upgrade Plan</button>
                                    <button class="btn btn-outline" style="color: var(--error); border-color: #fee2e2;"
                                        onclick="showToast('Cancellation request sent. You will be contacted.')">Cancel
                                        Subscription</button>
                                </div>
                            </div>
                        </div>

                        <!-- SECTION 2: Plan Comparison -->
                        <div>
                            <h3 style="margin-bottom: 20px;">Compare Plans</h3>
                            <div class="plan-tabs">
                                <button class="plan-tab-btn active" onclick="switchPlanTab('msme', this)">MSME
                                    Plans</button>
                                <button class="plan-tab-btn" onclick="switchPlanTab('ca', this)">CA Plans</button>
                            </div>

                            <div id="tab-msme" class="pricing-table-container">
                                <table class="pricing-table">
                                    <thead>
                                        <tr>
                                            <th>Features</th>
                                            <th>Starter</th>
                                            <th>Growth</th>
                                            <th class="highlight-cell">Pro (Current)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Monthly Price</td>
                                            <td>₹499/mo</td>
                                            <td>₹1,499/mo</td>
                                            <td class="highlight-cell"
                                                style="font-weight: bold; color: var(--primary-color);">₹2,999/mo</td>
                                        </tr>
                                        <tr>
                                            <td>Invoices/mo</td>
                                            <td>25</td>
                                            <td>100</td>
                                            <td class="highlight-cell">Unlimited</td>
                                        </tr>
                                        <tr>
                                            <td>Capabilities</td>
                                            <td>GST/TDS tracking</td>
                                            <td>+AI ITC matching</td>
                                            <td class="highlight-cell">+CA collaboration</td>
                                        </tr>
                                        <tr>
                                            <td>Analytics</td>
                                            <td>Basic dashboard</td>
                                            <td>Bank integration</td>
                                            <td class="highlight-cell">Advanced reports</td>
                                        </tr>
                                        <tr>
                                            <td>Support</td>
                                            <td>Email alerts</td>
                                            <td>"Ask Niyam" chatbot</td>
                                            <td class="highlight-cell">Priority support</td>
                                        </tr>
                                        <tr>
                                            <td>Users</td>
                                            <td>1</td>
                                            <td>3</td>
                                            <td class="highlight-cell">10</td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td><button class="btn btn-outline"
                                                    style="padding: 6px 15px; font-size: 0.8rem;"
                                                    onclick="selectPlan('Starter')">Downgrade</button></td>
                                            <td><button class="btn btn-primary"
                                                    style="padding: 6px 15px; font-size: 0.8rem;"
                                                    onclick="selectPlan('Growth')">Switch to This</button></td>
                                            <td class="highlight-cell"><span class="badge"
                                                    style="background: var(--primary-color); color: white;">Current
                                                    Plan</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div id="tab-ca" class="pricing-table-container" style="display: none;">
                                <table class="pricing-table">
                                    <thead>
                                        <tr>
                                            <th>Features</th>
                                            <th>CA Solo</th>
                                            <th>CA Firm</th>
                                            <th>CA Enterprise</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Monthly Price</td>
                                            <td>₹1,999/mo</td>
                                            <td>₹4,999/mo</td>
                                            <td>₹9,999/mo</td>
                                        </tr>
                                        <tr>
                                            <td>Clients</td>
                                            <td>Up to 25</td>
                                            <td>Up to 100</td>
                                            <td>Unlimited</td>
                                        </tr>
                                        <tr>
                                            <td>Team Seats</td>
                                            <td>1</td>
                                            <td>3</td>
                                            <td>Unlimited</td>
                                        </tr>
                                        <tr>
                                            <td>Capabilities</td>
                                            <td>Client dashboard</td>
                                            <td>White-label portal</td>
                                            <td>Custom integrations</td>
                                        </tr>
                                        <tr>
                                            <td>Analytics</td>
                                            <td>Bulk deadline view</td>
                                            <td>Advanced analytics</td>
                                            <td>Dedicated manager</td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td><button class="btn btn-primary" onclick="selectPlan('CA Solo')">Switch
                                                    to This</button></td>
                                            <td><button class="btn btn-primary" onclick="selectPlan('CA Firm')">Switch
                                                    to This</button></td>
                                            <td><button class="btn btn-primary"
                                                    onclick="selectPlan('CA Enterprise')">Contact Sales</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- SECTION 3: Add-on Marketplace -->
                        <div>
                            <h3 style="margin-bottom: 20px;">Add-on Marketplace</h3>
                            <div class="addons-grid">
                                <div class="addon-card">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <b style="font-size: 1rem;">CA Portal Access</b>
                                        <div class="addon-toggle active"
                                            onclick="this.classList.toggle('active'); toggleAddon('CA Portal', 999)">
                                        </div>
                                    </div>
                                    <p style="font-size: 0.8rem; color: var(--text-light); line-height: 1.4;">Unlimited
                                        CA collaborations and white-labeled reporting.</p>
                                    <p class="addon-price">₹999<span
                                            style="font-size: 0.8rem; font-weight: normal; color: var(--text-light);">/mo</span>
                                    </p>
                                </div>

                                <div class="addon-card">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <b style="font-size: 1rem;">Advanced Analytics</b>
                                        <div class="addon-toggle"
                                            onclick="this.classList.toggle('active'); toggleAddon('Analytics', 499)">
                                        </div>
                                    </div>
                                    <p style="font-size: 0.8rem; color: var(--text-light); line-height: 1.4;">Predictive
                                        insights and custom report builder.</p>
                                    <p class="addon-price">₹499<span
                                            style="font-size: 0.8rem; font-weight: normal; color: var(--text-light);">/mo</span>
                                    </p>
                                </div>

                                <div class="addon-card">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <b style="font-size: 1rem;">Priority Support</b>
                                        <div class="addon-toggle"
                                            onclick="this.classList.toggle('active'); toggleAddon('Support', 299)">
                                        </div>
                                    </div>
                                    <p style="font-size: 0.8rem; color: var(--text-light); line-height: 1.4;">2-hour
                                        response time with a dedicated support agent.</p>
                                    <p class="addon-price">₹299<span
                                            style="font-size: 0.8rem; font-weight: normal; color: var(--text-light);">/mo</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- SECTION 4: Invoice History -->
                        <div>
                            <div
                                style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px;">
                                <h3 style="margin: 0;">Invoice History</h3>
                                <a href="#" style="font-size: 0.85rem; color: var(--primary-color); font-weight: 600;"
                                    onclick="showToast('Fetching complete invoice history...')">View All Invoices</a>
                            </div>
                            <div class="pricing-table-container">
                                <table class="pricing-table" style="text-align: left;">
                                    <thead>
                                        <tr>
                                            <th style="text-align: left;">Date</th>
                                            <th style="text-align: left;">Description</th>
                                            <th style="text-align: left;">Amount</th>
                                            <th style="text-align: left;">Status</th>
                                            <th style="text-align: left;">Invoice</th>
                                        </tr>
                                    </thead>
                                    <tbody id="invoice-history-body">
                                        <!-- Will be populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data & Privacy Section -->
                <div id="settings-privacy" class="settings-section">
                    <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="card">
                            <h3 style="margin-bottom: 15px;">Export Your Data</h3>
                            <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 20px;">Download all
                                your business data, invoices, and filing records in a secure ZIP archive.</p>
                            <button class="btn btn-outline" style="width: 100%;"
                                onclick="showToast('Preparing your archive. This may take a few minutes.')"><i
                                    data-feather="download" style="width: 16px; margin-right: 8px;"></i> Request Data
                                Export</button>
                        </div>
                        <div class="card" style="border-top: 4px solid var(--error);">
                            <h3 style="margin-bottom: 15px; color: var(--error);">Delete Account</h3>
                            <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 20px;">Permanently
                                remove all your business data and account access. This action cannot be undone.</p>
                            <button class="btn-outline"
                                style="width: 100%; border-color: var(--error); color: var(--error);"
                                onclick="showToast('Confirm account deletion in full version.')">Close Account
                                Permanently</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- View: Help & Support -->
            <section id="view-support" class="content-view">
                <div class="welcome-bar">
                    <h1>Help & Support Center</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-outline" onclick="showToast('Scheduling a demo...')"><i
                                data-feather="calendar" style="width: 14px; margin-right: 5px;"></i> Schedule
                            Demo</button>
                        <button class="btn btn-primary" onclick="showToast('Opening live chat...')"><i
                                data-feather="message-circle" style="width: 14px; margin-right: 5px;"></i> Live
                            Chat</button>
                    </div>
                </div>

                <div class="card"
                    style="margin-bottom: 30px; background: var(--primary-color); color: white; padding: 40px; text-align: center;">
                    <h2 style="margin-bottom: 15px;">How can we help you today?</h2>
                    <div style="max-width: 600px; margin: 0 auto; position: relative;">
                        <input type="text" id="support-search" placeholder="Search documentation, guides, and FAQs..."
                            style="width: 100%; padding: 15px 20px 15px 45px; border-radius: 30px; border: none; font-size: 1rem; color: var(--text-dark);"
                            onkeyup="searchSupport(this.value)">
                        <i data-feather="search" style="position: absolute; left: 18px; top: 15px; color: #94a3b8;"></i>
                    </div>
                </div>

                <div class="support-grid">
                    <div>
                        <!-- FAQs -->
                        <div class="card">
                            <h3 style="margin-bottom: 20px;">Frequently Asked Questions</h3>

                            <div class="sidebar-group-label" style="margin: 20px 0 10px;">GST & TAXATION</div>
                            <div class="faq-item" onclick="this.classList.toggle('active')">
                                <div class="faq-question">What is GSTR-2B reconciliation? <i
                                        data-feather="chevron-down"></i></div>
                                <div class="faq-answer">GSTR-2B is an auto-populated ITC statement. Reconciliation
                                    involves matching the ITC available in GSTR-2B with the ITC recorded in your
                                    accounting books to ensure you don't over-claim or under-claim tax credits.</div>
                            </div>
                            <div class="faq-item" onclick="this.classList.toggle('active')">
                                <div class="faq-question">How often does Niyam AI sync with the GST portal? <i
                                        data-feather="chevron-down"></i></div>
                                <div class="faq-answer">By default, Niyam AI syncs every 24 hours. You can also trigger
                                    a manual sync anytime from the GST Filings dashboard.</div>
                            </div>

                            <div class="sidebar-group-label" style="margin: 20px 0 10px;">ROC & LEGAL</div>
                            <div class="faq-item" onclick="this.classList.toggle('active')">
                                <div class="faq-question">What happens if I miss the ROC deadline? <i
                                        data-feather="chevron-down"></i></div>
                                <div class="faq-answer">Missing ROC deadlines (AOC-4 or MGT-7) results in daily
                                    penalties (approx ₹100-200 per day) and potential disqualification of directors if
                                    continued for multiple years.</div>
                            </div>

                            <div class="sidebar-group-label" style="margin: 20px 0 10px;">GENERAL</div>
                            <div class="faq-item" onclick="this.classList.toggle('active')">
                                <div class="faq-question">How secure is my data on Niyam AI? <i
                                        data-feather="chevron-down"></i></div>
                                <div class="faq-answer">We use industry-standard AES-256 encryption for all data at rest
                                    and TLS 1.3 for data in transit. Your financial data is never shared with third
                                    parties without your explicit consent.</div>
                            </div>
                        </div>

                        <!-- Video Tutorials -->
                        <div class="card" style="margin-top: 20px;">
                            <h3 style="margin-bottom: 20px;">Video Tutorials</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="video-card" onclick="showToast('Playing tutorial...')">
                                    <div class="video-overlay">
                                        <i data-feather="play-circle"
                                            style="width: 48px; height: 48px; margin-bottom: 10px;"></i>
                                        <p style="font-weight: 600;">Getting Started with Niyam</p>
                                        <p style="font-size: 0.75rem; opacity: 0.8;">4:20 mins</p>
                                    </div>
                                </div>
                                <div class="video-card" onclick="showToast('Playing tutorial...')">
                                    <div class="video-overlay">
                                        <i data-feather="play-circle"
                                            style="width: 48px; height: 48px; margin-bottom: 10px;"></i>
                                        <p style="font-weight: 600;">Mastering GST Reconciliation</p>
                                        <p style="font-size: 0.75rem; opacity: 0.8;">6:15 mins</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <!-- Contact Form -->
                        <div class="card">
                            <h3 style="margin-bottom: 15px;">Contact Support</h3>
                            <p style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 15px;">Expect a
                                response within 2 business hours.</p>
                            <div class="form-group">
                                <label>Subject</label>
                                <select
                                    style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                                    <option>Technical Issue</option>
                                    <option>Filing Assistance</option>
                                    <option>Billing Query</option>
                                    <option>Feature Request</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Message</label>
                                <textarea placeholder="Describe your issue in detail..."
                                    style="width: 100%; height: 100px; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;"></textarea>
                            </div>
                            <button class="btn btn-primary" style="width: 100%;"
                                onclick="showToast('Support ticket #NYM-842 created!')">Send Message</button>
                        </div>

                        <!-- Support Channels -->
                        <div class="card" style="background: #f8fafc;">
                            <h3 style="margin-bottom: 15px;">Other Channels</h3>
                            <div style="display: flex; flex-direction: column; gap: 15px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="color: #2563eb;"><i data-feather="mail"></i></div>
                                    <div>
                                        <p style="font-size: 0.85rem; font-weight: 600;">Email Us</p>
                                        <p style="font-size: 0.75rem; color: var(--text-light);">help@niyam.ai</p>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="color: #10b981;"><i data-feather="phone"></i></div>
                                    <div>
                                        <p style="font-size: 0.85rem; font-weight: 600;">Call Priority Support</p>
                                        <p style="font-size: 0.75rem; color: var(--text-light);">+91 1800-NIYAM (64926)
                                        </p>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="color: #0ea5e9;"><i data-feather="twitter"></i></div>
                                    <div>
                                        <p style="font-size: 0.85rem; font-weight: 600;">Twitter Support</p>
                                        <p style="font-size: 0.75rem; color: var(--text-light);">@NiyamSupport</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Ask Niyam Widget -->
    <div class="ask-niyam-widget">
        <div class="chat-box" id="chat-box" style="display: none; height: 400px; width: 350px;">
            <div class="chat-header">
                <span>Ask Niyam AI</span>
                <i data-feather="x" style="cursor: pointer;" id="chat-close"></i>
            </div>
            <div class="chat-messages" id="chat-messages" style="flex-grow: 1;">
                <div class="message message-bot">
                    Hello! I'm Niyam. How can I help you with your compliance today?
                </div>
            </div>
            <form class="chat-input" id="chat-form">
                <input type="text" placeholder="Ask a question..." id="chat-input" required>
                <button type="submit" class="btn btn-primary" style="padding: 10px;"><i data-feather="send"
                        style="width: 18px;"></i></button>
            </form>
        </div>
        <div class="chat-toggle" id="chat-toggle" style="position: relative;">
            <i data-feather="message-square"></i>
            <span
                style="position: absolute; top: -5px; right: -5px; background: var(--error); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; display: flex; align-items: center; justify-content: center; font-weight: 700;">1</span>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px;" id="modal-title">Filing Integration</h3>
            <p style="color: var(--text-light); margin-bottom: 20px;" id="modal-body">In the full version, this would
                redirect you
                securely to the government portal or handle filing automatically.</p>
            <button class="btn btn-primary" id="modal-close">Got it</button>
        </div>
    </div>

    <script>
        feather.replace();

        // Handle User Name
        const businessName = localStorage.getItem("niyam_user_business") || "MSME Owner";
        const welcomeEl = document.getElementById("welcome-text");
        if (welcomeEl) welcomeEl.innerText = `Good morning, ${businessName}`;

        // View Switching Logic
        function switchView(viewId, element) {
            document.querySelectorAll(".sidebar-item").forEach(item => item.classList.remove("active"));
            if (element) element.classList.add("active");

            document.querySelectorAll(".content-view").forEach(view => view.classList.remove("active"));
            const targetView = document.getElementById(`view-${viewId}`);
            if (targetView) targetView.classList.add("active");

            if (viewId === 'calendar') {
                setTimeout(() => { calendar.render(); }, 100);
            }
            if (viewId === 'reports') {
                setTimeout(() => { initCharts(); }, 100);
            }

            feather.replace();
        }

        // Calendar Initialization
        let calendar;
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listMonth'
                },
                events: [
                    { title: 'GSTR-1 Filing', start: '2025-06-11', color: '#2563eb', extendedProps: { description: 'Monthly GSTR-1 return for sales' } },
                    { title: 'ROC Annual Return', start: '2025-06-15', color: '#ef4444', extendedProps: { description: 'Annual return for internal records' } },
                    { title: 'GSTR-3B Filing', start: '2025-06-20', color: '#2563eb', extendedProps: { description: 'Summary return for GST payment' } },
                    { title: 'TDS Payment', start: '2025-06-07', color: '#10b981', extendedProps: { description: 'Monthly TDS deposit for salary/rent' } },
                    { title: 'Income Tax Audit', start: '2025-06-30', color: '#f59e0b', extendedProps: { description: 'Final tax audit submission' } }
                ],
                eventClick: function (info) {
                    showEventDetails(info.event.title, info.event.startStr, info.event.extendedProps.description);
                }
            });
        });

        function showEventDetails(title, date, description = 'Compliance filing requirement.') {
            const modal = document.getElementById('modal');
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-body').innerText = `${description}\n\nDue Date: ${date}`;
            modal.style.display = 'flex';
        }

        function openAddDeadlineModal() {
            showToast('Add Deadline form coming soon in full version!');
        }

        // Handle File Upload & Mock OCR
        function handleFileUpload(input) {
            if (!input.files || !input.files[0]) return;
            const progress = document.getElementById("upload-progress");
            const bar = document.getElementById("progress-bar-inner");
            const percent = document.getElementById("progress-percent");
            const results = document.getElementById("ocr-results");

            progress.style.display = "block";
            results.style.display = "none";
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        progress.style.display = "none";
                        results.style.display = "block";
                        showToast("AI analysis complete! Data extracted.");
                    }, 500);
                } else {
                    width += Math.random() * 15;
                    if (width > 100) width = 100;
                    bar.style.width = width + "%";
                    percent.textContent = Math.floor(width) + "%";
                }
            }, 300);
        }

        // Chat Logic (Enhanced)
        const chatToggle = document.getElementById("chat-toggle");
        const chatBox = document.getElementById("chat-box");
        const chatClose = document.getElementById("chat-close");
        if (chatToggle) chatToggle.onclick = () => chatBox.style.display = chatBox.style.display === "none" ? "flex" : "none";
        if (chatClose) chatClose.onclick = () => chatBox.style.display = "none";

        const chatForm = document.getElementById("chat-form");
        const chatInput = document.getElementById("chat-input");
        const chatMessages = document.getElementById("chat-messages");

        if (chatForm) {
            chatForm.onsubmit = (e) => {
                e.preventDefault();
                const text = chatInput.value.trim().toLowerCase();
                if (!text) return;

                addChatMessage(chatInput.value, "user");
                chatInput.value = "";

                setTimeout(() => {
                    let response = "I'm Niyam AI. I can help with GST, TDS, ROC, or general compliance. What specific area are you inquiring about?";

                    const intentMap = {
                        "gst": "Your GST health is excellent! June liability is ₹42,500. You have ₹1.12 Lakhs available ITC.",
                        "tds": "Your next TDS payment (Section 194I) of ₹45,200 is due on Jan 07. Use the TDS calculator for interest estimates.",
                        "roc": "ROC filing for AOC-4 and MGT-7 is pending. DIR-3 KYC is verified. Need help with the MCA portal?",
                        "bank": "You can connect HDFC or ICICI bank in the 'Connect Bank' section to sync your statements.",
                        "deadline": "The most urgent deadline is TDS payment on Jan 07, followed by GSTR-1 on Jan 11.",
                        "support": "Our experts are available for premium consultation. Would you like to book a CA session?",
                        "help": "I can assist with: GST reconciliation, TDS interest calculation, ROC filing status, and document extraction."
                    };

                    for (const [key, value] of Object.entries(intentMap)) {
                        if (text.includes(key)) {
                            response = value;
                            break;
                        }
                    }
                    addChatMessage(response, "bot");
                }, 600);
            };
        }

        function addChatMessage(text, sender) {
            const msg = document.createElement("div");
            msg.className = `message message-${sender}`;
            msg.textContent = text;
            chatMessages.appendChild(msg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Actionable Metrics & Filtering
        function filterTable(status) {
            const rows = document.querySelectorAll("#deadlines-table tbody tr");
            rows.forEach(row => {
                row.style.display = (status === "all" || row.dataset.status === status) ? "" : "none";
            });
            showToast(`Filtering for ${status} items...`);
        }

        function showHealthBreakdown() { showToast("Health: GST 100%, TDS 70%, ROC 0%"); }

        function showToast(message) {
            let container = document.getElementById("toast-container");
            if (!container) {
                container = document.createElement("div");
                container.id = "toast-container";
                document.body.appendChild(container);
            }
            const toast = document.createElement("div");
            toast.className = "toast";
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = "0";
                toast.style.transform = "translateY(-20px)";
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Modal triggers
        document.body.addEventListener("click", (e) => {
            if (e.target.classList.contains("btn-action")) {
                const modal = document.getElementById("modal");
                if (modal) modal.style.display = "flex";
            }
        });
        const modalClose = document.getElementById("modal-close");
        if (modalClose) modalClose.onclick = () => document.getElementById("modal").style.display = "none";
        // TDS Interest Calculator
        function calculateTDSInterest() {
            const amount = parseFloat(document.getElementById('calc-amount').value);
            const months = parseFloat(document.getElementById('calc-months').value);
            const resultDiv = document.getElementById('calc-result');
            const valueEl = document.getElementById('calc-interest-value');

            if (isNaN(amount) || isNaN(months) || amount <= 0 || months <= 0) {
                showToast("Please enter valid positive numbers.");
                return;
            }

            // Formula: Principal * 1.5% * Months
            const interest = amount * 0.015 * months;
            valueEl.innerText = `₹${interest.toLocaleString('en-IN')}`;
            resultDiv.style.display = 'block';
            showToast("Interest calculated successfully!");
        }

        // Reports & Analytics Logic
        function calculatePenalty() {
            const days = parseInt(document.getElementById('penalty-days').value);
            const rate = parseInt(document.getElementById('penalty-type').value);
            const resultDiv = document.getElementById('penalty-result');
            const valueEl = document.getElementById('penalty-value');

            if (isNaN(days) || days < 0) {
                showToast("Please enter a valid number of days.");
                return;
            }

            const penalty = days * rate;
            valueEl.innerText = `₹${penalty.toLocaleString('en-IN')}`;
            resultDiv.style.display = 'block';
            showToast("Penalty estimate updated.");
        }

        // Settings Tab Logic
        function switchSettingsTab(tabId, element) {
            // Update buttons
            document.querySelectorAll('.settings-tab-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');

            // Update sections
            document.querySelectorAll('.settings-section').forEach(sec => sec.classList.remove('active'));
            document.getElementById(`settings-${tabId}`).classList.add('active');

            if (tabId === 'billing') {
                renderInvoices();
            }

            feather.replace();
        }

        // Subscription Module Logic
        function switchPlanTab(tabId, element) {
            document.querySelectorAll('.plan-tab-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');

            document.getElementById('tab-msme').style.display = tabId === 'msme' ? 'block' : 'none';
            document.getElementById('tab-ca').style.display = tabId === 'ca' ? 'block' : 'none';
        }

        function selectPlan(planName) {
            const effectiveDate = new Date();
            effectiveDate.setDate(effectiveDate.getDate() + 1);

            const message = `
                <b>Confirm Plan Change</b><br>
                Switching to: ${planName}<br>
                Effective date: ${effectiveDate.toLocaleDateString()}<br>
                Prorated charge: ₹450 (calculated for remaining period)
            `;

            showToast(message);
        }

        function toggleAddon(name, price) {
            showToast(`${name} add-on updated! Monthly bill adjusted by ₹${price}.`);
        }

        const invoices = [
            { date: "2025-09-15", desc: "Monthly Subscription", amount: "₹2,999", status: "Paid", id: "INV-2025-09-001" },
            { date: "2025-08-15", desc: "Monthly Subscription", amount: "₹2,999", status: "Paid", id: "INV-2025-08-001" },
            { date: "2025-07-15", desc: "Monthly Subscription + CA Add-on", amount: "₹3,998", status: "Paid", id: "INV-2025-07-001" },
            { date: "2025-06-15", desc: "Monthly Subscription", amount: "₹2,999", status: "Paid", id: "INV-2025-06-001" },
            { date: "2025-05-15", desc: "Monthly Subscription", amount: "₹2,999", status: "Paid", id: "INV-2025-05-001" }
        ];

        function renderInvoices() {
            const container = document.getElementById('invoice-history-body');
            if (!container) return;

            container.innerHTML = invoices.map(inv => `
                <tr>
                    <td>${inv.date}</td>
                    <td>${inv.desc}</td>
                    <td>${inv.amount}</td>
                    <td><span class="badge" style="background: var(--success); color: white;">${inv.status}</span></td>
                    <td><button class="btn btn-outline" style="font-size: 0.7rem; padding: 4px 8px;" onclick="showToast('Downloading ${inv.id}...')">PDF</button></td>
                </tr>
            `).join('');
        }

        function searchSupport(query) {
            query = query.toLowerCase();
            const items = document.querySelectorAll('.faq-item');
            items.forEach(item => {
                const text = item.innerText.toLowerCase();
                item.style.display = text.includes(query) ? 'block' : 'none';
            });
        }

        // Reports & Analytics: Upgraded Charting Logic
        let currentChartData = {
            '6M': {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                taxLiability: [58000, 62000, 52000, 68000, 62000, 55000],
                cashFlow: [450000, 480000, 420000, 510000, 490000, 530000],
                itcAvailable: [32000, 28000, 35000, 41000, 38000, 42000]
            },
            '1Y': {
                labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                taxLiability: [45000, 48000, 52000, 60000, 58000, 65000, 58000, 62000, 52000, 68000, 62000, 55000],
                cashFlow: [410000, 430000, 460000, 480000, 450000, 520000, 450000, 480000, 420000, 510000, 490000, 530000],
                itcAvailable: [25000, 27000, 30000, 32000, 31000, 35000, 32000, 28000, 35000, 41000, 38000, 42000]
            },
            'QTD': {
                labels: ['Apr', 'May', 'Jun'],
                taxLiability: [68000, 62000, 55000],
                cashFlow: [510000, 490000, 530000],
                itcAvailable: [41000, 38000, 42000]
            }
        };

        function initCharts() {
            const lCtx = document.getElementById('liabilityChart');
            const cCtx = document.getElementById('cashflowChart');
            if (!lCtx || !cCtx) return;

            // Initialize Liability Chart (The Upgraded One)
            if (window.lChart) window.lChart.destroy();

            const data = currentChartData['6M'];
            window.lChart = new Chart(lCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'Tax Liability',
                            data: data.taxLiability,
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 2,
                            pointHoverRadius: 6,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Cash Flow',
                            data: data.cashFlow,
                            borderColor: '#10b981',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 2,
                            pointHoverRadius: 6,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'ITC Available',
                            data: data.itcAvailable,
                            borderColor: '#8b5cf6',
                            borderDash: [5, 5],
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 2,
                            pointHoverRadius: 6,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                boxWidth: 6,
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1e293b',
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 12 },
                            padding: 12,
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            suggestedMax: 100000,
                            ticks: {
                                font: { size: 10 },
                                callback: value => '₹' + (value / 1000) + 'k'
                            },
                            grid: { color: '#e2e8f0', drawBorder: false }
                        },
                        y1: {
                            type: 'linear',
                            display: false, // Hidden but used for scaling cash flow
                            position: 'right',
                            grid: { drawOnChartArea: false }
                        },
                        x: {
                            ticks: { font: { size: 10 } },
                            grid: { display: false }
                        }
                    }
                }
            });

            // Populate Table
            updateDataTable('6M');

            // Initialize Compliance Impact on Cash Flow Chart (Multi-line Area Chart)
            if (window.cChart) window.cChart.destroy();

            if (!cCtx) {
                console.error('Cashflow chart canvas not found');
                return;
            }

            const ctx = cCtx.getContext('2d');
            if (!ctx) {
                console.error('Unable to get 2D context for cashflow chart');
                return;
            }

            // Create gradient for Cash Flow area fill
            const cashFlowGradient = ctx.createLinearGradient(0, 0, 0, 400);
            cashFlowGradient.addColorStop(0, 'rgba(16, 185, 129, 0.3)');
            cashFlowGradient.addColorStop(1, 'rgba(16, 185, 129, 0.05)');

            // Initial data setup
            window.complianceChartData = {
                '6M': {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    cashFlow: [720000, 680000, 750000, 710000, 730000, 690000],
                    complianceCosts: [62000, 58000, 75000, 68000, 72000, 65000],
                    impactScore: [78, 82, 75, 85, 80, 88]
                },
                '1Y': {
                    labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    cashFlow: [690000, 710000, 695000, 725000, 705000, 740000, 720000, 680000, 750000, 710000, 730000, 690000],
                    complianceCosts: [58000, 62000, 59000, 70000, 64000, 73000, 62000, 58000, 75000, 68000, 72000, 65000],
                    impactScore: [80, 78, 82, 76, 81, 77, 78, 82, 75, 85, 80, 88]
                },
                'YTD': {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    cashFlow: [720000, 680000, 750000, 710000, 730000, 690000],
                    complianceCosts: [62000, 58000, 75000, 68000, 72000, 65000],
                    impactScore: [78, 82, 75, 85, 80, 88]
                }
            };

            const initialData = window.complianceChartData['6M'];

            window.cChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: initialData.labels,
                    datasets: [
                        {
                            label: 'Cash Flow',
                            data: initialData.cashFlow,
                            borderColor: '#10b981',
                            backgroundColor: cashFlowGradient,
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 4,
                            pointHoverRadius: 7,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Compliance Costs',
                            data: initialData.complianceCosts,
                            borderColor: '#ef4444',
                            backgroundColor: 'transparent',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 7,
                            pointBackgroundColor: '#ef4444',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Impact Score',
                            data: initialData.impactScore,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'transparent',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 4,
                            pointHoverRadius: 7,
                            pointBackgroundColor: '#8b5cf6',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            align: 'end',
                            labels: {
                                usePointStyle: true,
                                boxWidth: 8,
                                font: {
                                    size: 11,
                                    weight: '600',
                                    family: 'Inter, system-ui, sans-serif'
                                },
                                color: '#64748b',
                                padding: 15
                            },
                            onClick: function (e, legendItem, legend) {
                                const index = legendItem.datasetIndex;
                                const ci = legend.chart;
                                const meta = ci.getDatasetMeta(index);
                                meta.hidden = meta.hidden === null ? !ci.data.datasets[index].hidden : null;
                                ci.update();
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1e293b',
                            titleFont: {
                                size: 13,
                                weight: 'bold',
                                family: 'Inter, system-ui, sans-serif'
                            },
                            bodyFont: {
                                size: 12,
                                family: 'Inter, system-ui, sans-serif'
                            },
                            padding: 14,
                            cornerRadius: 8,
                            displayColors: true,
                            boxWidth: 8,
                            boxHeight: 8,
                            usePointStyle: true,
                            callbacks: {
                                title: function (tooltipItems) {
                                    return tooltipItems[0].label;
                                },
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }

                                    if (context.datasetIndex === 2) {
                                        // Impact Score
                                        label += context.parsed.y + '/100';
                                    } else {
                                        // Cash Flow and Compliance Costs
                                        label += new Intl.NumberFormat('en-IN', {
                                            style: 'currency',
                                            currency: 'INR',
                                            maximumFractionDigits: 0
                                        }).format(context.parsed.y);
                                    }
                                    return label;
                                },
                                afterBody: function (tooltipItems) {
                                    const dataIndex = tooltipItems[0].dataIndex;
                                    const cashFlow = window.cChart.data.datasets[0].data[dataIndex];
                                    const complianceCost = window.cChart.data.datasets[1].data[dataIndex];
                                    const percentage = ((complianceCost / cashFlow) * 100).toFixed(1);
                                    return '\nCompliance: ' + percentage + '% of cash flow';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: false,
                            grid: {
                                color: '#f1f5f9',
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    size: 10,
                                    family: 'Inter, system-ui, sans-serif'
                                },
                                color: '#94a3b8',
                                callback: function (value) {
                                    return '₹' + (value / 1000) + 'k';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Amount (₹)',
                                font: {
                                    size: 11,
                                    weight: '600',
                                    family: 'Inter, system-ui, sans-serif'
                                },
                                color: '#64748b'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            min: 0,
                            max: 100,
                            grid: {
                                drawOnChartArea: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    size: 10,
                                    family: 'Inter, system-ui, sans-serif'
                                },
                                color: '#8b5cf6',
                                callback: function (value) {
                                    return value;
                                }
                            },
                            title: {
                                display: true,
                                text: 'Impact Score',
                                font: {
                                    size: 11,
                                    weight: '600',
                                    family: 'Inter, system-ui, sans-serif'
                                },
                                color: '#8b5cf6'
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    size: 11,
                                    weight: '500',
                                    family: 'Inter, system-ui, sans-serif'
                                },
                                color: '#64748b'
                            }
                        }
                    },
                    animation: {
                        duration: 750,
                        easing: 'easeInOutQuart'
                    }
                }
            });

            // Update summary metrics
            updateComplianceMetrics('6M');
        }

        function updateChartPeriod(period, btn) {
            // Update UI
            document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const data = currentChartData[period];
            if (!data || !window.lChart) return;

            // Update Chart
            window.lChart.data.labels = data.labels;
            window.lChart.data.datasets[0].data = data.taxLiability;
            window.lChart.data.datasets[1].data = data.cashFlow;
            window.lChart.data.datasets[2].data = data.itcAvailable;

            // Adjust Y-axis scale for 1Y if needed (liability remains around 100k)
            window.lChart.update();
            updateDataTable(period);
            showToast(`Showing ${period} trend.`);
        }

        function exportChart(chartId) {
            const canvas = document.getElementById(chartId);
            if (!canvas) return;
            const link = document.createElement('a');
            link.download = `NiyamAI-Report-${new Date().toISOString().split('T')[0]}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            showToast("Report exported as PNG.");
        }

        function toggleDataTable() {
            const container = document.getElementById('data-table-container');
            const link = event.target;
            if (container.style.display === 'none') {
                container.style.display = 'block';
                link.innerText = 'Hide Data Table';
            } else {
                container.style.display = 'none';
                link.innerText = 'Show Data Table';
            }
        }

        function updateDataTable(period) {
            const body = document.getElementById('chart-data-body');
            const data = currentChartData[period];
            if (!body || !data) return;

            body.innerHTML = data.labels.map((label, i) => `
                <tr>
                    <td style="padding: 6px; border: 1px solid #e2e8f0;">${label}</td>
                    <td style="padding: 6px; border: 1px solid #e2e8f0;">₹${data.taxLiability[i].toLocaleString()}</td>
                    <td style="padding: 6px; border: 1px solid #e2e8f0;">₹${data.cashFlow[i].toLocaleString()}</td>
                    <td style="padding: 6px; border: 1px solid #e2e8f0;">₹${data.itcAvailable[i].toLocaleString()}</td>
                </tr>
            `).join('');
        }

        // Compliance Chart Period Filter
        function updateComplianceChartPeriod(period, btn) {
            // Update button states
            document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const data = window.complianceChartData[period];
            if (!data || !window.cChart) return;

            // Update chart data
            window.cChart.data.labels = data.labels;
            window.cChart.data.datasets[0].data = data.cashFlow;
            window.cChart.data.datasets[1].data = data.complianceCosts;
            window.cChart.data.datasets[2].data = data.impactScore;

            window.cChart.update();
            updateComplianceMetrics(period);
            showToast(`Showing ${period} compliance data.`);
        }

        // Calculate and Update Compliance Metrics
        function updateComplianceMetrics(period) {
            const data = window.complianceChartData[period];
            if (!data) return;

            // Calculate average compliance cost percentage
            let totalPercentage = 0;
            for (let i = 0; i < data.cashFlow.length; i++) {
                totalPercentage += (data.complianceCosts[i] / data.cashFlow[i]) * 100;
            }
            const avgPercentage = (totalPercentage / data.cashFlow.length).toFixed(1);

            // Find highest impact month (lowest score = highest impact)
            let highestImpactIndex = 0;
            let lowestScore = data.impactScore[0];
            for (let i = 1; i < data.impactScore.length; i++) {
                if (data.impactScore[i] < lowestScore) {
                    lowestScore = data.impactScore[i];
                    highestImpactIndex = i;
                }
            }
            const highestImpactMonth = data.labels[highestImpactIndex];

            // Get current (latest) impact score
            const currentScore = data.impactScore[data.impactScore.length - 1];

            // Update DOM elements
            const avgPctEl = document.getElementById('avg-compliance-pct');
            const highestImpactEl = document.getElementById('highest-impact-month');
            const currentScoreEl = document.getElementById('current-impact-score');

            if (avgPctEl) avgPctEl.innerText = avgPercentage + '%';
            if (highestImpactEl) highestImpactEl.innerText = highestImpactMonth;
            if (currentScoreEl) currentScoreEl.innerText = currentScore + '/100';
        }

        window.onclick = (e) => {
            const modal = document.getElementById("modal");
            if (e.target == modal) modal.style.display = "none";
        };

        // Authentication Check
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('niyam_access_token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            // Update User Profile Info
            const userName = localStorage.getItem('niyam_user_name') || 'User';
            const businessName = localStorage.getItem('niyam_business_name') || 'My Business';

            // Try to find elements to update (generic selectors since we can't find exact IDs easily)
            const welcomeMsg = document.querySelector('h2'); // Usually the first h2 is the welcome message
            if (welcomeMsg && welcomeMsg.innerText.includes('Good')) {
                welcomeMsg.innerText = `Good Morning, ${userName.split(' ')[0]}`;
            }

            // Update business name in sidebar or header if valid element found
            // (Assuming generic placement for now, can be refined)

            // Add Logout Functionality
            const logoutItem = document.querySelector('.sidebar-item:last-child');
            if (logoutItem && logoutItem.innerText.includes('Settings')) {
                // Determine if there's a logout button, if not, create one
                // Actually, let's just look for a "Log Out" text or add a logout button to the sidebar
            }
        });

        function logout() {
            localStorage.removeItem('niyam_access_token');
            localStorage.removeItem('niyam_refresh_token');
            localStorage.removeItem('niyam_user_name');
            localStorage.removeItem('niyam_business_name');
            localStorage.removeItem('niyam_user_business');
            window.location.href = 'login.html';
        }

        // Add Logout Button to Sidebar
        const sidebar = document.querySelector('.sidebar');
        if (sidebar) {
            const logoutBtn = document.createElement('div');
            logoutBtn.className = 'sidebar-item';
            logoutBtn.style.marginTop = 'auto';
            logoutBtn.style.cursor = 'pointer';
            logoutBtn.style.color = '#ef4444';
            logoutBtn.innerHTML = '<i data-feather="log-out"></i> Log Out';
            logoutBtn.onclick = logout;
            sidebar.appendChild(logoutBtn);
            if (window.feather) feather.replace();
        }
    </script>
</body>

</html>